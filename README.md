# 1μ£Όμ°¨ κ³Όμ 
## μ£Όμ : TDDλ΅ κ°λ°ν•κΈ°
> μΌμ •: 2024λ…„ 12μ›” 14μΌ ~ 20μΌ
---
# π“ κ°μ”
## 1οΈβƒ£ κ³Όμ  ν•„μ μ‚¬ν•­
- Nest.js μ κ²½μ° Typescript , Spring μ κ²½μ° Kotlin / Java μ¤‘ ν•λ‚λ΅ μ‘μ„±ν•©λ‹λ‹¤.
    - ν”„λ΅μ νΈμ— μ²¨λ¶€λ μ„¤μ • νμΌμ€ μμ •ν•μ§€ μ•λ„λ΅ ν•©λ‹λ‹¤.
- ν…μ¤νΈ μΌ€μ΄μ¤μ μ‘μ„± λ° μ‘μ„± μ΄μ λ¥Ό μ£Όμ„μΌλ΅ μ‘μ„±ν•λ„λ΅ ν•©λ‹λ‹¤.
- ν”„λ΅μ νΈ λ‚΄μ μ£Όμ„μ„ μ°Έκ³ ν•μ—¬ ν•„μ”ν• κΈ°λ¥μ„ μ‘μ„±ν•΄μ£Όμ„Έμ”.
- λ¶„μ‚° ν™κ²½μ€ κ³ λ ¤ν•μ§€ μ•μµλ‹λ‹¤.
- `/point` ν¨ν‚¤μ§€ (λ””λ ‰ν† λ¦¬) λ‚΄μ— `PointService` κΈ°λ³Έ κΈ°λ¥ μ‘μ„±
- `/database` ν¨ν‚¤μ§€μ κµ¬ν„μ²΄λ” μμ •ν•μ§€ μ•κ³ , μ΄λ¥Ό ν™μ©ν•΄ κΈ°λ¥μ„ κµ¬ν„
- κ° κΈ°λ¥μ— λ€ν• λ‹¨μ„ ν…μ¤νΈ μ‘μ„±
> μ΄ 4κ°€μ§€ κΈ°λ³Έ κΈ°λ¥ (ν¬μΈνΈ μ΅°ν, ν¬μΈνΈ μ¶©μ „/μ‚¬μ© λ‚΄μ—­ μ΅°ν, μ¶©μ „, μ‚¬μ©) μ„ κµ¬ν„ν•©λ‹λ‹¤.

## 2οΈβƒ£ κ³Όμ  μƒμ„Έ
`point` ν¨ν‚¤μ§€μ TODO μ™€ ν…μ¤νΈμ½”λ“λ¥Ό μ‘μ„±ν•΄μ£Όμ„Έμ”.

**μ”κµ¬ μ‚¬ν•­**  
ν¬μΈνΈ μ΅°ν, ν¬μΈνΈ μ¶©μ „/μ‚¬μ© λ‚΄μ—­ μ΅°ν, μ¶©μ „, μ‚¬μ©
```
- PATCH  `/point/{id}/charge` : ν¬μΈνΈλ¥Ό μ¶©μ „ν•λ‹¤.
- PATCH `/point/{id}/use` : ν¬μΈνΈλ¥Ό μ‚¬μ©ν•λ‹¤.
- GET `/point/{id}` : ν¬μΈνΈλ¥Ό μ΅°νν•λ‹¤.
- GET `/point/{id}/histories` : ν¬μΈνΈ λ‚΄μ—­μ„ μ΅°νν•λ‹¤.
```
- μ”κ³ κ°€ λ¶€μ΅±ν•  κ²½μ°, ν¬μΈνΈ μ‚¬μ©μ€ μ‹¤ν¨ν•μ—¬μ•Ό ν•©λ‹λ‹¤.
- λ™μ‹μ— μ—¬λ¬ κ±΄μ ν¬μΈνΈ μ¶©μ „, μ΄μ© μ”μ²­μ΄ λ“¤μ–΄μ¬ κ²½μ° μμ°¨μ μΌλ΅ μ²λ¦¬λμ–΄μ•Ό ν•©λ‹λ‹¤.

## 3οΈβƒ£ Pass μ΅°κ±΄
### β… κΈ°λ³Έκ³Όμ 
- ν¬μΈνΈ μ¶©μ „, μ‚¬μ©μ— λ€ν• μ •μ±… μ¶”κ°€ (μ”κ³  λ¶€μ΅±, μµλ€ μ”κ³  λ“±)
- λ™μ‹μ— μ—¬λ¬ μ”μ²­μ΄ λ“¤μ–΄μ¤λ”λΌλ„ μμ„λ€λ΅ (νΉμ€ ν•λ²μ— ν•λ‚μ μ”μ²­μ”©λ§) μ μ–΄λ  μ μλ„λ΅ λ¦¬ν©ν† λ§
- λ™μ‹μ„± μ μ–΄μ— λ€ν• ν†µν•© ν…μ¤νΈ μ‘μ„±
### β… μ‹¬ν™”κ³Όμ 
- λ™μ‹μ„± μ μ–΄ λ°©μ‹μ— λ€ν• λ¶„μ„ λ° λ³΄κ³ μ„ μ‘μ„± ( **README.md** )

---
# π“ μ‘μ—… κΈ°λ΅

## 1οΈβƒ£ ν”„λ΅μ νΈ ν…ν”λ¦Ώ λ¶„μ„ λ° μ”κ±΄ μ •μ
### β… ν…μ΄λΈ”
```
+--------------------+       +-----------------------------+
|   UserPointTable   |       |      PointHistoryTable      |
+--------------------+       +-----------------------------+
| PK  id             |<------| FK  userId                  |
|     point          |       | PK  id                      |
|     updateMillis   |       |     amount                  |
+--------------------+       |     type (TransactionType)  |
                             |     updateMillis            |
                             +-----------------------------+
```

### UserPointTable
|μ»¬λΌ λ…|νƒ€μ…|μ„¤λ…|
|---|---|---|
|id|long|μ‚¬μ©μ μ‹λ³„ id|
|point|long|ν•΄λ‹Ή μ‚¬μ©μμ μ”μ—¬ point|
|updateMillis|long|μ—…λ°μ΄νΈ μΌμ(λ°€λ¦¬μ΄ λ‹¨μ„, νƒ€μ„μ¤νƒ¬ν”„)|

### PointHistoryTable
|μ»¬λΌ λ…|νƒ€μ…|μ„¤λ…|
|---|---|---|
|id|long|νΈλμ­μ… μ‹λ³„ id|
|userId|long|μ‚¬μ©μ μ‹λ³„ id|
|amount|long|ν¬μΈνΈ λ³€κ²½ κΈμ•΅|
|type|TransactionType|νΈλμ­μ… μ ν• (CHARGE - μ¶©μ „, USE - μ‚¬μ©)|
|updateMillis|long|μ—…λ°μ΄νΈ μΌμ(λ°€λ¦¬μ΄ λ‹¨μ„, νƒ€μ„μ¤νƒ¬ν”„)|

### β… ν¬μΈνΈ νΈλμ­μ… μΆ…λ¥
| Type   | μ„¤λ… |
|--------|----|
| CHARGE | μ¶©μ „ |
|USE| μ‚¬μ© |

### β… API λ…μ„Έ λ° κΈ°λ¥ μ”κµ¬μ‚¬ν•­
### ν¬μΈνΈ μ΅°ν
- **Endpoint**
  - GET /{id}
- **Path Parameter**
  - id: (long) μ΅°νν•  μ μ €μ ID
- **Response**
  ```json
    {
      "id": 1,
      "point": 1000,
      "updateMillis": 1672531200000
    }
  ```
- **κΈ°λ¥ μ”κµ¬μ‚¬ν•­**
  - idλ΅ νΉμ • userμ ν¬μΈνΈ μ΅°ν
  - userκ°€ μ΅΄μ¬ν•μ§€ μ•μ„ κ²½μ° 404 λ°ν™
- **κ³ λ ¤μ‚¬ν•­**
  - idκ°€ μλ»λ ν•μ‹(μμ, μ«μκ°€ μ•„λ‹ κ°’ λ“±)μΌ κ²½μ° μ²λ¦¬
- **ν–‰λ™λ¶„μ„**
  - μ”μ²­: μ μ € IDλ¥Ό λ°›μ•„ ν•΄λ‹Ή μ μ €μ ν¬μΈνΈ μ •λ³΄λ¥Ό λ°ν™
  - λ™μ‘:
    1. idκ°€ μ ν¨ν• κ°’μΈμ§€ ν™•μΈ(Validation)
    2. μ μ €κ°€ μ΅΄μ¬ν•λ”μ§€ ν™•μΈ(Service)
    3. μ μ €μ ν¬μΈνΈ μ •λ³΄λ¥Ό λ°ν™(Service)
- **ν…μ¤νΈ μΌ€μ΄μ¤**
  - μ„±κ³µ
    - μ μ €κ°€ μ΅΄μ¬ν•λ” κ²½μ° μ¬λ°”λ¥Έ ν¬μΈνΈ μ •λ³΄λ¥Ό λ°ν™ν•λ‹¤.(Service)
    - idκ°€ μ ν¨ν•  κ²½μ° True, μ ν¨ν•μ§€ μ•μ„ κ²½μ° Falseλ¥Ό λ°ν™ν•λ‹¤.(Validation)
  - μ‹¤ν¨
    - idκ°€ μ£Όμ–΄μ§€μ§€ μ•μΌλ©΄ μ΅°νλ¥Ό μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: idκ°€ μ—†λ” κ²½μ° Service νΈμ¶μ„ ν•μ§€ μ•λ”λ‹¤. (Controller)
    - μ£Όμ–΄μ§„ idκ°€ μ ν¨ν• κ°’μ΄ μ•„λ‹λ©΄ μ΅°νλ¥Ό μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: id κ²€μ¦ validationμ„ ν†µν•΄ Falseλ¥Ό λ°ν™λ°›μ„ κ²½μ°, μ΅°ν μ‹¤ν¨. (Service)
    - μ μ €κ°€ μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ μ΅°νλ¥Ό μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: ν•΄λ‹Ή idλ¥Όκ°€μ§„ Userκ°€ μλ”μ§€ ν™•μΈ (Service)

### ν¬μΈνΈ μ¶©μ „/μ‚¬μ© λ‚΄μ—­ μ΅°ν
- **Endpoint**
    - GET /{id}/histories
- **Path Parameter**
    - id: (long) μ΅°νν•  μ μ €μ ID
- **Response**
  ```json
    [
      { 
        "id": 1,
        "userId": 1,
        "amount": 100,
        "updateMillis": 1672531200000,
        "type": "CHARGE"
      },
      { 
        "id": 2,
        "userId": 1,
        "amount": 100,
        "updateMillis": 1672531200000,
        "type": "USE"
      }
    ]
  ```
- **κΈ°λ¥ μ”κµ¬μ‚¬ν•­**
  - νΉμ • μ μ €μ ν¬μΈνΈ λ‚΄μ—­ μ΅°ν(μ¶©μ „ λ° μ‚¬μ© μ΄λ ¥)
  - λ‚΄μ—­μ΄ μ—†μ„ κ²½μ° λΉ λ°°μ—΄ λ°ν™
- **κ³ λ ¤μ‚¬ν•­**
  - λ°μ΄ν„° μ •λ ¬(μµμ‹  μ), νμ΄μ§• μ²λ¦¬(ν…ν”λ¦Ώ μ†μ¤μ—μ„λ” νμ΄μ§• κ΄€λ ¨ λ‚΄μ©μ΄ μ—†μΌλ―€λ΅ μ μ™Έ)
- **ν–‰λ™ λ¶„μ„**
  - μ”μ²­: μ μ € IDλ¥Ό λ°›μ•„ ν•΄λ‹Ή μ μ €μ ν¬μΈνΈ μ¶©μ „/μ‚¬μ© λ‚΄μ—­ λ¦¬μ¤νΈλ¥Ό λ°ν™
  - λ™μ‘
    1. idκ°€ μ ν¨ν• κ°’μΈμ§€ ν™•μΈ(Validation)
    2. μ μ €κ°€ μ΅΄μ¬ν•λ”μ§€ ν™•μΈ(Service)
    3. μ μ €μ λ‚΄μ—­μ΄ μμΌλ©΄ λ°ν™, μ—†μΌλ©΄ λΉ λ°°μ—΄μ„ λ°ν™(Service)
- **ν…μ¤νΈ μΌ€μ΄μ¤**
  - μ„±κ³µ
    - μ μ €κ°€ μ΅΄μ¬ν•λ©° λ‚΄μ—­μ΄ μμΌλ©΄ λ‚΄μ—­ λ¦¬μ¤νΈλ¥Ό λ°ν™ν•λ‹¤. (Service)
    - μ μ €κ°€ μ΅΄μ¬ν•μ§€λ§ λ‚΄μ—­μ΄ μ—†μΌλ©΄ λΉ λ°°μ—΄μ„ λ°ν™ν•λ‹¤. (Service)
    - idκ°€ μ ν¨ν•  κ²½μ° True, μ ν¨ν•μ§€ μ•μ„ κ²½μ° Falseλ¥Ό λ°ν™ν•λ‹¤.(Validation)
  - μ‹¤ν¨
    - idκ°€ μ£Όμ–΄μ§€μ§€ μ•μΌλ©΄ μ΅°νλ¥Ό μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: idκ°€ μ—†λ” κ²½μ° Service νΈμ¶μ„ ν•μ§€ μ•λ”λ‹¤. (Controller)
    - μ£Όμ–΄μ§„ idκ°€ μ ν¨ν• κ°’μ΄ μ•„λ‹λ©΄ μ΅°νλ¥Ό μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: id κ²€μ¦ validationμ„ ν†µν•΄ Falseλ¥Ό λ°ν™λ°›μ„ κ²½μ°, μ΅°ν μ‹¤ν¨. (Service)
    - μ μ €κ°€ μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ μ΅°νλ¥Ό μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: ν•΄λ‹Ή idλ¥Όκ°€μ§„ Userκ°€ μλ”μ§€ ν™•μΈ (Service)

### ν¬μΈνΈ μ¶©μ „
- **Endpoint**
    - PATCH /{id}/charge
- **Path Parameter**
    - id: (long) ν¬μΈνΈ μ¶©μ „ν•  μ μ €μ ID
    - amount: (long) μ¶©μ „ ν•  ν¬μΈνΈ
- **Response**
  ```json
    {
        "id": 1,
        "point": 1500,
        "updateMillis": 1672531500000
    }
  ```
- **κΈ°λ¥ μ”κµ¬μ‚¬ν•­**
  - μ”μ²­λ°›μ€ amountλ§νΌ μ μ €μ ν¬μΈνΈλ¥Ό μ¶©μ „.
  - μ¶©μ „ κΈμ•΅μ€ λ°λ“μ‹ 0λ³΄λ‹¤ μ»¤μ•Ό ν•¨.
- **κ³ λ ¤μ‚¬ν•­**
  - μ¶©μ „ μ‹¤ν¨ μ‹ λ΅¤λ°±(ν„μ¬ DB κµ¬ν„μ²΄λ” λ΅¤λ°±μ„ μ κ³µν•μ§€ μ•μ)
  - (μ¶”κ°€ λ²”μ„)μµλ€ μ”κ³  μ΄μƒ μ¶©μ „ λ¶κ°€
- **ν–‰λ™ λ¶„μ„**
  - μ”μ²­: μ μ € IDμ™€ μ¶©μ „ κΈμ•΅μ„ λ°›μ•„ ν¬μΈνΈλ¥Ό μ¶©μ „
  - λ™μ‘:
    1. μ…λ ¥λ idμ™€ amountκ°€ μ ν¨ν• κ°’μΈμ§€ ν™•μΈ(Validation)
    2. μ μ €κ°€ μ΅΄μ¬ν•  κ²½μ° ν„μ¬ μ μ €μ ν¬μΈνΈ μ΅°ν, μ μ €κ°€ μ΅΄μ¬ν•μ§€ μ•μ„ κ²½μ° 0 (Service)
    3. ν¬μΈνΈ μ¶©μ „ μ‹ μµλ€ μ”κ³ λ¥Ό λ„λ”μ§€ ν™•μΈ(μ¶”κ°€ λ²”μ„)(Service)
    4. μ¶©μ „ κΈμ•΅μ„ ν¬μΈνΈμ— λ”ν• λ’¤ UserPointTable μ—…λ°μ΄νΈ(Service)
    5. μ—…λ°μ΄νΈλ ν¬μΈνΈ μ •λ³΄λ¥Ό λ°ν™(Service)
- **ν…μ¤νΈ μΌ€μ΄μ¤**
  - μ„±κ³µ
    - μ ν¨ν• κΈμ•΅μ„ μ…λ ¥ν•λ©΄ (μ¶©μ „ ν›„ μµλ€ μ”κ³ λ¥Ό λ„μ§€ μ•μΌλ©΄) ν¬μΈνΈκ°€ μ •μƒμ μΌλ΅ μ¶©μ „λλ‹¤. (Service)
  - μ‹¤ν¨
    - idλ‚ amountκ°€ μ£Όμ–΄μ§€μ§€ μ•μΌλ©΄ μ¶©μ „μ„ μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: idλ‚ amountκ°€ μ—†λ” κ²½μ° Service νΈμ¶μ„ ν•μ§€ μ•λ”λ‹¤. (Controller)
    - μ£Όμ–΄μ§„ idλ‚ amountκ°€ μ ν¨ν• κ°’μ΄ μ•„λ‹λ©΄ μ¶©μ „μ„ μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: id, amount κ²€μ¦ validationμ„ ν†µν•΄ Falseλ¥Ό λ°ν™λ°›μ„ κ²½μ°, μ¶©μ „ μ‹¤ν¨. (Service)
    - μ¶©μ „ ν›„ ν¬μΈνΈκ°€ μµλ€ μ”κ³ λ¥Ό λ„μΌλ©΄ μ¶©μ „μ„ μ‹¤ν¨ν•λ‹¤.(μ¶”κ°€ λ²”μ„) κ²€μ¦: μµμΆ… ν¬μΈνΈκ°€ μµλ€ μ”κ³ λ¥Ό λ„λ”μ§€ ν™•μΈ (Service)

### ν¬μΈνΈ μ‚¬μ©
- **Endpoint**
    - PATCH /{id}/use
- **Path Parameter**
    - id: (long) ν¬μΈνΈ μ‚¬μ©ν•  μ μ €μ ID
    - amount: (long) μ‚¬μ© ν•  ν¬μΈνΈ
- **Response**
  ```json
    {
        "id": 1,
        "point": 1500,
        "updateMillis": 1672531500000
    }
  ```
- **κΈ°λ¥ μ”κµ¬μ‚¬ν•­**
    - μ”μ²­λ°›μ€ amountλ§νΌ μ μ €μ ν¬μΈνΈλ¥Ό μ‚¬μ©.
    - μ‚¬μ© κΈμ•΅μ€ λ°λ“μ‹ 0λ³΄λ‹¤ μ»¤μ•Ό ν•¨.
- **κ³ λ ¤μ‚¬ν•­**
    - μ‚¬μ© μ‹¤ν¨ μ‹ λ΅¤λ°±(ν„μ¬ DB κµ¬ν„μ²΄λ” λ΅¤λ°±μ„ μ κ³µν•μ§€ μ•μ)
    - (μ¶”κ°€ λ²”μ„)μ”κ³  μ΄μƒ μ‚¬μ© λ¶κ°€
- **ν–‰λ™ λ¶„μ„**
    - μ”μ²­: μ μ € IDμ™€ μ‚¬μ© κΈμ•΅μ„ λ°›μ•„ ν¬μΈνΈ μ‚¬μ©
    - λ™μ‘:
      1. μ…λ ¥λ idμ™€ amountκ°€ μ ν¨ν• κ°’μΈμ§€ ν™•μΈ(Validation)
      2. μ μ €κ°€ μ΅΄μ¬ν•λ”μ§€ ν™•μΈ(Service)
      3. μ μ €μ ν„μ¬ ν¬μΈνΈ μ΅°ν(Service)
      4. ν¬μΈνΈ μ‚¬μ© κΈμ•΅μ΄ ν„μ¬ μ”κ³ λ¥Ό λ„λ”μ§€ ν™•μΈ(μ¶”κ°€ λ²”μ„)(Service)
      5. ν¬μΈνΈ μ°¨κ° ν›„ UserPointTable μ—…λ°μ΄νΈ(Service)
      6. μ—…λ°μ΄νΈλ ν¬μΈνΈ μ •λ³΄λ¥Ό λ°ν™(Service)
- **ν…μ¤νΈ μΌ€μ΄μ¤**
  - μ„±κ³µ
    - μ μ €κ°€ μ΅΄μ¬ν•λ©° μ¶©λ¶„ν• μ”μ•΅μ΄ μμ„ κ²½μ° ν¬μΈνΈκ°€ μ •μƒμ μΌλ΅ μ°¨κ°λλ‹¤ (Service).
  - μ‹¤ν¨
    - idλ‚ amountκ°€ μ£Όμ–΄μ§€μ§€ μ•μΌλ©΄ μ¶©μ „μ„ μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: idλ‚ amountκ°€ μ—†λ” κ²½μ° Service νΈμ¶μ„ ν•μ§€ μ•λ”λ‹¤. (Controller)
    - μ£Όμ–΄μ§„ idλ‚ amountκ°€ μ ν¨ν• κ°’μ΄ μ•„λ‹λ©΄ μ¶©μ „μ„ μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: id, amount κ²€μ¦ validationμ„ ν†µν•΄ Falseλ¥Ό λ°ν™λ°›μ„ κ²½μ°, μ¶©μ „ μ‹¤ν¨. (Service)
    - μ μ €κ°€ μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ μ‚¬μ©μ„ μ‹¤ν¨ν•λ‹¤. - κ²€μ¦: ν•΄λ‹Ή idλ¥Ό κ°€μ§„ Userκ°€ μλ”μ§€ ν™•μΈ (Service)
    - μ‚¬μ©κΈμ•΅μ΄ μ”κ³ λ¥Ό λ„μΌλ©΄ μ‚¬μ©μ„ μ‹¤ν¨ν•λ‹¤.(μ¶”κ°€ λ²”μ„) κ²€μ¦: μ‚¬μ© ν¬μΈνΈκ°€ μ”κ³ λ¥Ό λ„λ”μ§€ ν™•μΈ (Service)

> **κ³ λ ¤μ‚¬ν•­ μ”μ•½**  
> - μ μ € μ΅΄μ¬ ν™•μΈ: ν¬μΈνΈ μ΅°ν, ν¬μΈνΈ μ΄λ ¥μ΅°ν, ν¬μΈνΈ μ‚¬μ©  
> - id, amount μ ν¨μ„±: μμ, μ«μκ°€ μ•„λ‹ κ²½μ° μ ν¨ν•μ§€ μ•μ

